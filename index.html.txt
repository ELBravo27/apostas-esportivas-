import requests
import time

# ConfiguraÃ§Ãµes da API
API_KEY = "SUA_CHAVE_AQUI"
BASE_URL = "https://v3.football.api-sports.io"
HEADERS = {
    'x-rapidapi-host': "v3.football.api-sports.io",
    'x-rapidapi-key': API_KEY
}

def get_live_matches():
    """Busca jogos que estÃ£o acontecendo agora."""
    url = f"{BASE_URL}/fixtures?live=all"
    response = requests.get(url, headers=HEADERS)
    return response.json().get('response', [])

def get_h2h_and_stats(home_id, away_id):
    """Analisa histÃ³rico de confrontos diretos (H2H)."""
    url = f"{BASE_URL}/fixtures/headtohead?h2h={home_id}-{away_id}&last=5"
    response = requests.get(url, headers=HEADERS)
    # LÃ³gica simples: contar mÃ©dia de gols nos Ãºltimos 5 confrontos
    h2h_data = response.json().get('response', [])
    total_goals = sum([f['goals']['home'] + f['goals']['away'] for f in h2h_data if f['goals']['home'] is not None])
    return total_goals / len(h2h_data) if h2h_data else 0

def analyze_match(match):
    """Aplica a lÃ³gica de anÃ¡lise para Over HT e FT."""
    fixture_id = match['fixture']['id']
    home_team = match['teams']['home']['name']
    away_team = match['teams']['away']['name']
    home_id = match['teams']['home']['id']
    away_id = match['teams']['away']['id']
    
    # Dados do jogo ao vivo
    score_home = match['goals']['home'] or 0
    score_away = match['goals']['away'] or 0
    elapsed = match['fixture']['status']['elapsed']
    
    # SimulaÃ§Ã£o de anÃ¡lise de histÃ³rico e H2H
    avg_h2h_goals = get_h2h_and_stats(home_id, away_id)
    
    print(f"\n--- Analisando: {home_team} vs {away_team} ({elapsed}') ---")
    
    # ESTRATÃ‰GIA OVER HT (Gols no 1Âº Tempo)
    # CritÃ©rio: Jogo entre 15-30 min, 0x0, H2H histÃ³rico alto (>2.5 gols)
    if 15 <= elapsed <= 30 and (score_home + score_away == 0):
        if avg_h2h_goals > 2.0:
            print(f"ðŸ”¥ ALERTA: PossÃ­vel Over 0.5 HT (H2H mÃ©dio: {avg_h2h_goals})")

    # ESTRATÃ‰GIA OVER FT (Gols no Jogo Todo)
    # CritÃ©rio: Segundo tempo, muitos ataques, placar apertado
    if elapsed >= 60 and (score_home + score_away <= 2):
        print(f"âœ… ALERTA: PossÃ­vel Over 1.5 ou 2.5 FT baseado no tempo de jogo.")

# ExecuÃ§Ã£o principal
if __name__ == "__main__":
    print("Iniciando Monitor de Jogos Ao Vivo...")
    matches = get_live_matches()
    
    if not matches:
        print("Nenhum jogo ao vivo no momento.")
    else:
        for match in matches:
            analyze_match(match)
            time.sleep(1) # Respeitar limite de taxa da API